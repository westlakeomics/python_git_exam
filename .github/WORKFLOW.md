# è‡ªåŠ¨åŒ– PR å·¥ä½œæµç¨‹è¯´æ˜

æœ¬é¡¹ç›®å®ç°äº†å®Œå…¨è‡ªåŠ¨åŒ–çš„ PR ç®¡ç†æµç¨‹ï¼Œæ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š

## âš ï¸ é¦–æ¬¡è®¾ç½®è¦æ±‚

**åœ¨ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥ä½œæµä¹‹å‰ï¼Œä»“åº“ç®¡ç†å‘˜å¿…é¡»å®Œæˆä¸€æ¬¡æ€§é…ç½®ï¼**

GitHub Actions é»˜è®¤æ— æ³•åˆ›å»º Pull Requestã€‚ç®¡ç†å‘˜éœ€è¦å¯ç”¨ç›¸åº”æƒé™ï¼š

- âš¡ **[5åˆ†é’Ÿå¿«é€Ÿè®¾ç½®æ¸…å•](QUICK_SETUP.md)** - æ¨èæ–°æ‰‹
- ğŸ“– **[å®Œæ•´è®¾ç½®æŒ‡å—](SETUP_GUIDE.md)** - è¯¦ç»†è¯´æ˜å’Œæ•…éšœæ’é™¤

**å¿«é€Ÿè®¾ç½®æ­¥éª¤**ï¼š
1. è¿›å…¥ä»“åº“ **Settings** â†’ **Actions** â†’ **General**
2. æ»šåŠ¨åˆ° **Workflow permissions** éƒ¨åˆ†
3. âœ… å‹¾é€‰ **"Allow GitHub Actions to create and approve pull requests"**
4. ç‚¹å‡» **Save**

å®Œæˆæ­¤è®¾ç½®åï¼Œä»¥ä¸‹è‡ªåŠ¨åŒ–åŠŸèƒ½å°†æ­£å¸¸å·¥ä½œã€‚

## åŠŸèƒ½æ¦‚è¿°

å½“ç”¨æˆ·ä¿®æ”¹ `src/bad_style.py` å¹¶æ¨é€åˆ°æ–°åˆ†æ”¯åï¼š

1. âœ… **è‡ªåŠ¨åˆ›å»º PR** - æ— éœ€æ‰‹åŠ¨æ“ä½œ
2. âœ… **è‡ªåŠ¨æ£€æµ‹ä»£ç è´¨é‡** - è¿è¡Œ ruffã€blackã€isortã€pytest
3. âœ… **è‡ªåŠ¨è®°å½•é€šè¿‡çš„åˆ†æ”¯** - å†™å…¥ `passed_branches/merged_branches.txt`
4. âœ… **è‡ªåŠ¨åˆ é™¤åˆå¹¶åçš„åˆ†æ”¯** - ä¿æŒä»“åº“æ•´æ´
5. âœ… **ä¿æŠ¤ main åˆ†æ”¯** - é˜²æ­¢å¼ºåˆ¶æ¨é€å’Œæœªæˆæƒçš„åˆå¹¶

## å·¥ä½œæµç¨‹è¯¦è§£

### ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·æ¨é€ä¿®æ”¹

```bash
# ç”¨æˆ·åˆ›å»ºæ–°åˆ†æ”¯å¹¶ä¿®æ”¹ä»£ç 
git checkout -b fix/username
# ä¿®æ”¹ src/bad_style.py
git add src/bad_style.py
git commit -m "fix: apply PEP 8 standards"
git push origin fix/username
```

### ç¬¬äºŒæ­¥ï¼šè‡ªåŠ¨åˆ›å»º PR

**è§¦å‘å™¨**: `.github/workflows/auto-pr.yml`

- **è§¦å‘æ¡ä»¶**: å‘é main åˆ†æ”¯æ¨é€æ—¶ä¿®æ”¹äº† `src/bad_style.py`
- **åŠŸèƒ½**:
  - æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ PRï¼ˆé¿å…é‡å¤ï¼‰
  - è‡ªåŠ¨åˆ›å»º PRï¼Œæ ‡é¢˜åŒ…å«åˆ†æ”¯å
  - PR æè¿°åŒ…å«éªŒè¯æ­¥éª¤è¯´æ˜

### ç¬¬ä¸‰æ­¥ï¼šè‡ªåŠ¨ä»£ç éªŒè¯

**è§¦å‘å™¨**: `.github/workflows/pr-validation.yml`

- **è§¦å‘æ¡ä»¶**: PR æ‰“å¼€æˆ–æ›´æ–°
- **æ£€æŸ¥é¡¹ç›®**:
  1. `ruff check .` - ä»£ç è´¨é‡æ£€æŸ¥
  2. `black --check .` - ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
  3. `isort --check-only .` - å¯¼å…¥æ’åºæ£€æŸ¥
  4. `pytest -v tests/` - å•å…ƒæµ‹è¯•

**ç»“æœ**: æ‰€æœ‰æ£€æŸ¥é€šè¿‡åï¼ŒPR å¯ä»¥åˆå¹¶

### ç¬¬å››æ­¥ï¼šåˆå¹¶åè‡ªåŠ¨å¤„ç†

**è§¦å‘å™¨**: `.github/workflows/post-merge.yml`

- **è§¦å‘æ¡ä»¶**: PR æˆåŠŸåˆå¹¶åˆ° main
- **æ‰§è¡Œæ“ä½œ**:
  1. **éªŒè¯åˆ†æ”¯å** - é˜²æ­¢æ³¨å…¥æ”»å‡»
  2. **è®°å½•åˆ†æ”¯** - æ·»åŠ åˆ° `passed_branches/merged_branches.txt`
     - æ ¼å¼: `YYYY-MM-DD HH:MM:SS UTC - branch-name`
     - æŒ‰æ—¶é—´æˆ³æ’åº
     - ä¿ç•™æ‰€æœ‰å†å²è®°å½•
  3. **æäº¤æ›´æ”¹** - è‡ªåŠ¨æäº¤è®°å½•æ–‡ä»¶åˆ° main
  4. **åˆ é™¤åˆ†æ”¯** - åˆ é™¤è¿œç¨‹åˆ†æ”¯

## åˆ†æ”¯ä¿æŠ¤é…ç½®

ä¸ºäº†ç¡®ä¿ main åˆ†æ”¯çš„å®‰å…¨ï¼Œéœ€è¦é…ç½®åˆ†æ”¯ä¿æŠ¤è§„åˆ™ã€‚è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š

ğŸ“– **[.github/BRANCH_PROTECTION.md](.github/BRANCH_PROTECTION.md)**

### å…³é”®ä¿æŠ¤æªæ–½

1. **ç¦æ­¢ç›´æ¥æ¨é€åˆ° main** - æ‰€æœ‰æ›´æ”¹å¿…é¡»é€šè¿‡ PR
2. **ç¦æ­¢å¼ºåˆ¶æ¨é€** - é˜²æ­¢å†å²è®°å½•è¢«è¦†ç›–
3. **è¦æ±‚çŠ¶æ€æ£€æŸ¥é€šè¿‡** - å¿…é¡»é€šè¿‡ CI éªŒè¯
4. **è¦æ±‚å®¡æ‰¹** - å¯é€‰ï¼Œæ ¹æ®å›¢é˜Ÿè§„æ¨¡é…ç½®

### å¿«é€Ÿè®¾ç½®ï¼ˆé€šè¿‡ GitHub UIï¼‰

1. è¿›å…¥ä»“åº“ **Settings** â†’ **Branches**
2. æ·»åŠ è§„åˆ™ï¼Œåˆ†æ”¯åç§°æ¨¡å¼: `main`
3. å¯ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š
   - âœ… Require a pull request before merging
   - âœ… Require status checks to pass before merging
     - æ·»åŠ  `validate` ä½œä¸ºå¿…éœ€æ£€æŸ¥
   - âœ… Block force pushes
   - âœ… Require conversation resolution before merging

## å®‰å…¨ç‰¹æ€§

### è¾“å…¥éªŒè¯

- **åˆ†æ”¯åéªŒè¯**: é˜²æ­¢è·¯å¾„éå† (`..`, `//`) å’Œæ³¨å…¥æ”»å‡»
- **å­—ç¬¦é™åˆ¶**: ä»…å…è®¸å­—æ¯ã€æ•°å­—ã€`-`ã€`_`ã€`/`

### å®‰å…¨æ“ä½œ

- **ä¸´æ—¶æ–‡ä»¶**: ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶è¿›è¡Œæ’åºï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
- **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ“ä½œéƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
- **æœ€å°æƒé™**: æ¯ä¸ªå·¥ä½œæµåªè¯·æ±‚å¿…éœ€çš„æƒé™

## æ–‡ä»¶ç»“æ„

```
.github/
â”œâ”€â”€ workflows/
â”‚   â”œâ”€â”€ auto-pr.yml         # è‡ªåŠ¨åˆ›å»º PR
â”‚   â”œâ”€â”€ pr-validation.yml   # PR ä»£ç éªŒè¯
â”‚   â””â”€â”€ post-merge.yml      # åˆå¹¶åå¤„ç†
â”œâ”€â”€ BRANCH_PROTECTION.md    # åˆ†æ”¯ä¿æŠ¤é…ç½®æŒ‡å—
â””â”€â”€ WORKFLOW.md            # æœ¬æ–‡ä»¶

passed_branches/
â”œâ”€â”€ merged_branches.txt     # è®°å½•é€šè¿‡çš„åˆ†æ”¯
â””â”€â”€ README.md              # è¯´æ˜æ–‡æ¡£
```

## æµ‹è¯•å·¥ä½œæµ

### æµ‹è¯•è‡ªåŠ¨ PR åˆ›å»º

```bash
git checkout -b test/auto-pr-test
echo "# test" >> src/bad_style.py
git add src/bad_style.py
git commit -m "test: trigger auto PR"
git push origin test/auto-pr-test
```

é¢„æœŸç»“æœ: è‡ªåŠ¨åˆ›å»º PR

### æµ‹è¯• PR éªŒè¯

- æ¨é€ç¬¦åˆ PEP 8 çš„ä»£ç  â†’ éªŒè¯é€šè¿‡ âœ…
- æ¨é€ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç  â†’ éªŒè¯å¤±è´¥ âŒ

### æµ‹è¯•åˆå¹¶åå¤„ç†

1. åˆå¹¶ä¸€ä¸ªé€šè¿‡éªŒè¯çš„ PR
2. æ£€æŸ¥ `passed_branches/merged_branches.txt` - åº”è¯¥åŒ…å«æ–°æ¡ç›®
3. æ£€æŸ¥è¿œç¨‹åˆ†æ”¯ - åº”è¯¥å·²è¢«åˆ é™¤

## æ•…éšœæ’é™¤

### âš ï¸ PR åˆ›å»ºå¤±è´¥ï¼šæƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
pull request create failed: GraphQL: GitHub Actions is not permitted to create or approve pull requests
```

**åŸå› **ï¼šGitHub Actions é»˜è®¤æ²¡æœ‰åˆ›å»º PR çš„æƒé™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ğŸ‘‰ æŸ¥çœ‹ [SETUP_GUIDE.md](SETUP_GUIDE.md) è·å–è¯¦ç»†è®¾ç½®è¯´æ˜
2. å¿«é€Ÿä¿®å¤ï¼š
   - è¿›å…¥ä»“åº“ **Settings** â†’ **Actions** â†’ **General**
   - æ‰¾åˆ° **Workflow permissions** éƒ¨åˆ†
   - âœ… å‹¾é€‰ "Allow GitHub Actions to create and approve pull requests"
   - ç‚¹å‡» **Save**

### PR æœªè‡ªåŠ¨åˆ›å»º

- ç¡®è®¤ä¿®æ”¹äº† `src/bad_style.py`
- ç¡®è®¤ä¸æ˜¯æ¨é€åˆ° main åˆ†æ”¯
- ç¡®è®¤å·²å¯ç”¨ GitHub Actions åˆ›å»º PR çš„æƒé™ï¼ˆè§ä¸Šï¼‰
- æ£€æŸ¥ Actions æ ‡ç­¾é¡µçš„å·¥ä½œæµè¿è¡Œæ—¥å¿—

### éªŒè¯å¤±è´¥

- è¿è¡Œæœ¬åœ°æ£€æŸ¥: `ruff check .`ã€`black --check .`ã€`isort --check-only .`ã€`pytest tests/`
- ä¿®å¤é—®é¢˜åé‡æ–°æ¨é€

### åˆ†æ”¯æœªåˆ é™¤

- æ£€æŸ¥å·¥ä½œæµæ—¥å¿—
- å¯èƒ½çš„åŸå› : æƒé™ä¸è¶³ã€ç½‘ç»œé—®é¢˜
- å¯ä»¥æ‰‹åŠ¨åˆ é™¤: `git push origin --delete branch-name`

## ç»´æŠ¤å»ºè®®

1. **å®šæœŸå®¡æŸ¥** `passed_branches/merged_branches.txt` çš„å†…å®¹
2. **ç›‘æ§å·¥ä½œæµ** å¤±è´¥æƒ…å†µï¼ŒåŠæ—¶è°ƒæ•´
3. **æ›´æ–°ä¾èµ–** å®šæœŸæ›´æ–° GitHub Actions ç‰ˆæœ¬
4. **å®¡æŸ¥æ—¥å¿—** æ£€æŸ¥å¼‚å¸¸çš„åˆ†æ”¯åæˆ–æ¨¡å¼

## ç›¸å…³æ–‡æ¡£

- [README.md](../README.md) - é¡¹ç›®ä¸»æ–‡æ¡£
- [BRANCH_PROTECTION.md](.github/BRANCH_PROTECTION.md) - åˆ†æ”¯ä¿æŠ¤è¯¦ç»†é…ç½®
- [passed_branches/README.md](passed_branches/README.md) - åˆ†æ”¯è®°å½•è¯´æ˜

## æŠ€æœ¯æ ˆ

- **GitHub Actions** - CI/CD è‡ªåŠ¨åŒ–
- **GitHub CLI (gh)** - PR ç®¡ç†
- **Python 3.11** - ä»£ç è¿è¡Œç¯å¢ƒ
- **ruff / black / isort** - ä»£ç è´¨é‡å·¥å…·
- **pytest** - æµ‹è¯•æ¡†æ¶

## æ€»ç»“

æ­¤è‡ªåŠ¨åŒ–ç³»ç»Ÿç¡®ä¿ï¼š

âœ… æ‰€æœ‰ä»£ç æ›´æ”¹éƒ½ç»è¿‡å®¡æŸ¥å’Œæµ‹è¯•  
âœ… main åˆ†æ”¯ä¿æŒå¹²å‡€å’Œå—ä¿æŠ¤  
âœ… åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸå®Œå…¨è‡ªåŠ¨åŒ–ç®¡ç†  
âœ… å®Œæ•´çš„åˆå¹¶å†å²è®°å½•  
âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ  

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»º issue è®¨è®ºã€‚
